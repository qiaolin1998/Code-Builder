// 测试FB2800功能块的主程序
FUNCTION_BLOCK FB2801 
TITLE = 'Test Yield Calculation'

// 变量声明
VAR
    // 测试用的皮带秤总累计量
    Test_Product_Total:REAL := 0.0;
    // 初始化信号
    Test_Initialize:BOOL := FALSE;
    // FB2800实例
    fbProductCount:FB2800;
    // 测试输出变量
    Test_White_Class:REAL:=0.0;   
    Test_Night_Class:REAL:=0.0;
    Test_Day:REAL:=0.0;
    Test_Month:REAL:=0.0;
    Test_Year:REAL:=0.0;
    Test_Init_Done:BOOL:=0;
    // 新增：白班每三小时产量测试变量
    Test_White_3H_1:REAL:=0.0;
    Test_White_3H_2:REAL:=0.0;
    Test_White_3H_3:REAL:=0.0;
    Test_White_3H_4:REAL:=0.0;
    // 新增：夜班每三小时产量测试变量
    Test_Night_3H_1:REAL:=0.0;
    Test_Night_3H_2:REAL:=0.0;
    Test_Night_3H_3:REAL:=0.0;
    Test_Night_3H_4:REAL:=0.0;
    // 模拟时间控制
    Simulate_Time:INT := 0;
    // 测试步骤控制
    Test_Step:INT := 0;
END_VAR

// 程序逻辑
// 模拟时间流逝和产量增加
Simulate_Time := Simulate_Time + 1;

// 每10个循环增加1吨产量
IF Simulate_Time MOD 10 = 0 THEN
    Test_Product_Total := Test_Product_Total + 1.0;
END_IF;

// 测试步骤控制
CASE Test_Step OF
    0: // 初始状态
        IF NOT Test_Init_Done THEN
            Test_Initialize := TRUE;
        ELSE
            Test_Initialize := FALSE;
            Test_Step := 1;
        END_IF;
    1: // 正常运行状态
        Test_Initialize := FALSE;
        // 每100个循环重置一次
        IF Simulate_Time MOD 100 = 0 THEN
            Test_Step := 0;
        END_IF;
END_CASE;

// 调用FB2800功能块
fbProductCount(Product_Total := Test_Product_Total, 
              Initialize := Test_Initialize,
              Product_White_Class := Test_White_Class, 
              Product_Night_Class := Test_Night_Class, 
              Product_Day := Test_Day, 
              Product_Month := Test_Month, 
              Product_Year := Test_Year,
              // 新增：白班每三小时产量输出
              Product_White_3H_1 := Test_White_3H_1,
              Product_White_3H_2 := Test_White_3H_2,
              Product_White_3H_3 := Test_White_3H_3,
              Product_White_3H_4 := Test_White_3H_4,
              // 新增：夜班每三小时产量输出
              Product_Night_3H_1 := Test_Night_3H_1,
              Product_Night_3H_2 := Test_Night_3H_2,
              Product_Night_3H_3 := Test_Night_3H_3,
              Product_Night_3H_4 := Test_Night_3H_4,
              Init_Done := Test_Init_Done);

// 输出测试结果
// 可以通过HMI或调试工具查看这些变量的值
// 新增：每三小时产量的监控
// Test_White_3H_1: 白班第一段(9:00-12:00)
// Test_White_3H_2: 白班第二段(12:00-15:00)
// Test_White_3H_3: 白班第三段(15:00-18:00)
// Test_White_3H_4: 白班第四段(18:00-21:00)
// Test_Night_3H_1: 夜班第一段(21:00-24:00)
// Test_Night_3H_2: 夜班第二段(0:00-3:00)
// Test_Night_3H_3: 夜班第三段(3:00-6:00)
// Test_Night_3H_4: 夜班第四段(6:00-9:00)

END_FUNCTION_BLOCK
